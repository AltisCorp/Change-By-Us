<!DOCTYPE html>
<html class='universe'>
	
	<head class='heavens'>
		<title>{% block title %}GAM Templates{% endblock %}</title>
		
		<!-- Always force IE9 rendering engine & Chrome Frame; remove this if you use the .htaccess -->
		<!-- <meta http-equiv="X-UA-Compatible" content="IE=9,chrome=1"/> -->
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		
		<meta name="description" content=""/>
		<meta name="author" content=""/>
		
		<link rel="icon" href="/static/images/favicon.ico"/>
		<link rel="shortcut icon" href="/static/images/favicon.ico"/>
		<link rel="apple-touch-icon" href="/apple-touch-icon.png"/>
		
		<link rel="stylesheet" href="/static/css/tc.reset.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="/static/css/tc.gam.fontfaces.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="/static/css/tc.gam.main.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="/static/css/fileuploader.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="/static/css/tc.gam.search.map.css" type="text/css" media="screen" />
		{% if d.template_data and not(d.template_data.user) and d.template_data.app_mode == 'beta' %}
		<link rel="stylesheet" href="/static/css/tc.gam.splash.css" type="text/css" media="screen" />
		{% endif %}
		{% if d.template_data and d.template_data.user %}
		<link rel="stylesheet" href="/static/css/tc.gam.admin.css" type="text/css" media="screen" />
		{% endif %}
		
		{% block javascript_header %}
		<script>
			var app_page = {
				data:{},
				features:[]
			};
			app_page.features.push(function(app){
				tc.util.log('Give A Minute: Base');
				app.components.modal = new tc.modal(app,{
					element:tc.jQ('#modal')
				});
				app.components.top_bar = tc.top_bar(tc.jQ(".stratosphere"), {});
			});
		</script>
		{% endblock %}
		
		<script type="text/javascript" src="http://use.typekit.com/mco2pzd.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

		<!--[if IE]>
		<link rel="stylesheet" href="/static/css/ie/tc.gam.ie.css" type="text/css" media="screen" charset="utf-8"/>
		<![endif]-->
		
		<!--[if lte IE 8]>
		<link rel="stylesheet" href="/static/css/ie/tc.gam.ie8.css" type="text/css" media="screen" charset="utf-8"/>
		<![endif]-->
		
		<!--[if lte IE 7]>
		<link rel="stylesheet" href="/static/css/ie/tc.gam.ie7.css" type="text/css" media="screen" charset="utf-8"/>
		<![endif]-->
	
	</head>
	
	<!-- the "green-nyc" class is to decorate page with green-specific styles -->
	<body class='earth {% if d.template_data and d.template_data.user %}logged-in{% endif %} {% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}admin{%endif%} {% if d.template_data and d.template_data.project and d.template_data.project.data.info.is_official and d.template_data.project.data.info.is_official == 1 %}green-nyc{% endif %} {% if d.template_data and not(d.template_data.user) and d.template_data.app_mode == 'beta' %}beta-splash{% endif %}'>
	
	<div id="fb-root"></div>
	<script>
 		window.fbAsyncInit = function() {
			FB.init({appId: '{{d.facebook_app_id}}', status: true, cookie: true,
					xfbml: true});
			};
			(function() {
				var e = document.createElement('script'); e.async = true;
				e.src = document.location.protocol +
					'//connect.facebook.net/en_US/all.js';
				document.getElementById('fb-root').appendChild(e);
			}());
    </script>
		
		<div class='exosphere'>
		
			<div class='atmosphere'>
				<div class='stratosphere'>
					<ul class="navbar clearfix">
						<li class="home nyc {% if d.template_data and d.template_data.app_mode == 'beta' %}beta-logo{% endif %}">
							<a href="/"><span>Change by Us NYC</span></a>
						</li>
						<!--<li class="simplicity">
							<a href="http://www.nyc.gov/html/simplicity/html/about/about.shtml" target="_blank"><span>NYC SimpliCity</span></a>
						</li>-->
						<li class="news-about">
							<a href='http://nycblog.changeby.us'>News</a>
							<a href='/about'>About</a>
						</li>
						<li class="search">
							<form action='/search' method='GET'>
								<input type='text' name='terms' value="{% if d.template_data and d.template_data.search_terms %}{{ d.template_data.search_terms }}{% endif %}" />
								<input type='submit' value='Search' />
							</form>
						</li>
						<li class="userland">
							<div class="join"><a href='/join'>Join</a></div>
							<div class='login'><a href='/login'>Login</a></div>
							<div class='messages {% if d.template_data and d.template_data.user and d.template_data.user.data.num_new_messages > 0 %}has-messages{% endif %}'><a href='/useraccount#user-account,messages'>
								<span class="indicator">{% if d.template_data and d.template_data.user and d.template_data.user.data.num_new_messages > 0 %}<span class="num">{{ d.template_data.user.data.num_new_messages }}</span>{% endif %}</span></a></div>
							<div class='username'>
								<a href='/useraccount'><span class="unbold">Hi, </span>{% if d.template_data and d.template_data.user %}{{ d.template_data['user'].data.f_name }}{% endif %}!</a>
								<div class="dropdown no-js">
									<div class="membrane">
										<a href="/useraccount">Account</a>
										<a href="#logout">Log out</a>
									</div>
								</div>
							</div>
							<div class='myprojects'>
								<a href='/useraccount'><span class="unbold">My </span>Projects</a>
								<div class="dropdown no-js">
									<div class="membrane">
										{% if d.template_data and d.template_data.user %}
											{% if d.template_data.user.data.projects|length > 0 %}
												{% for project in d.template_data.user.data.projects %}
													<a href="/project/{{ project.project_id }}">{{ project.title }}</a>
												{% endfor %}
											{% else %}
													<a href="/create" style="min-width: 130px; text-align: center"><em>Create a project!</em></a>
											{% endif %}
										{% endif %}
									</div>
								</div>
							</div>
						</li>
						<li class="splashland"><!-- .splashland can be deleted after beta period is over -->
							<div class="join"><span class="fancy-caps">Have <span>an</span> invite code?</span><a href='/join'>Sign Up</a></div>
							<div class='login'><a href='/login'>Login</a></div>
						</li>
					</ul><!--end navbar-->
					
					{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}
						<ul class="adminbar">
							<li class="content"><a href="/cms/content">Content</a></li>
							<li class="admin-settings"><a href="/cms/admin">Admin Settings</a></li>
							{% block project_admin %}{% endblock %}
						</ul>
					{% endif %}
					
				</div>
			</div>
			
			{% block continent %}
				<div class='continent'>
					<div class='headlands'>
					
					</div>
					
					<div class='midlands'>
					
					</div>
					
					<div class='foothills'>
				</div>
			{% endblock %}
						
		</div>
		
		<!-- Javascript goes here -->
		<script type="text/javascript" src="/static/js/libs/jquery-1.5.1.js"></script>
		<script type="text/javascript" src="/static/js/libs/jqtools.tabs.js"></script>
		<script type="text/javascript" src="/static/js/libs/jqtools.tooltips.js"></script>
		<script type="text/javascript" src="/static/js/libs/jqtools.dynamic.js"></script>
		<script type="text/javascript" src="/static/js/libs/jqtools.scrollable.js"></script>
		<script type="text/javascript" src="/static/js/libs/jqtools.overlay.js"></script>
		<script type="text/javascript" src="/static/js/libs/jqtools.expose.js"></script>
		<script type="text/javascript" src="/static/js/libs/jquery.easing.1.3.js"></script>
		<script type="text/javascript" src="/static/js/libs/jquery.hashchange.js"></script>
		<script type="text/javascript" src="/static/js/libs/jquery.color.js"></script>
		<script type="text/javascript" src="/static/js/libs/jquery.elastic.js"></script>
		<script type="text/javascript" src="/static/js/libs/fileuploader.js"></script>
		<script type="text/javascript" src="/static/js/libs/tc.util.js"></script>
		<script type="text/javascript" src="/static/js/libs/prettyCheckboxes.js"></script>
		<script type="text/javascript" src="/static/js/libs/prettyDate.js"></script>
				
		<script type="text/javascript" src="/static/js/tc.gam.validate.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.merlin.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.topbar.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.modal.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.carousel.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.tooltip.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.locationDropdown.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.project.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.invite.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.user_handler.js"></script>
		<script type="text/javascript" src="/static/js/tc.gam.app.js"></script>
		
		<!-- detect user agent for js + css browser fixes later -->
		<script type="text/javascript">
			var ua = tc.jQ.browser;
			
			if (ua.mozilla) { /* gecko 1.9.1 is for FF3.5, 1.9.0 for FF3 */
				if (ua.version.slice(0,5) == "1.9.0") { tc.jQ('body').addClass('ff3') }
				else if (ua.version.slice(0,5) == "1.9.1") { tc.jQ('body').addClass('ff3-5') }
			};
			if (ua.webkit) {
				tc.jQ('body').addClass('webkit')
			};
		</script>
		
		{% block page_js %}{% endblock page_js %}
		
		<script type='text/javascript'>
			jQuery(document).one('ready',function(e){
				
				tc.jQ('input[type=checkbox],input[type=radio]')
					.not('.has-prettycheckbox')
					.prettyCheckboxes();
					
				tc.jQ(".time-since").time_since(); //pretty date formatting
				
				{% if d.template_data and d.template_data.user %} app_page.user = {{ d.template_data.user.json }}; {% else %} app_page.user = null; {% endif %}
				{% if d.template_data and d.template_data.project_user %} app_page.project_user = {{ d.template_data.project_user.json }}; {% else %} app_page.project_user = null; {% endif %}
				{% if d.locations %} app_page.data.locations = {{ d.locations.json }}; {% endif %}
				{% if d.template_data and d.template_data.locations %} app_page.data.locations = {{ d.template_data.locations.json }}; {% endif %}
				if(!app_page.data.locations){ app_page.data.locations = []; }
				{% if d.template_data and d.template_data.redir_from %} app_page.data.redir_from = "{{ d.template_data.redir_from }}"; {% endif %}
				{% if d.all_ideas %} app_page.data.all_ideas = {{ d.all_ideas.json }}; {% else %} app_page.data.all_ideas = null; {% endif %}
				
				tc.util.log(':::: APP_PAGE ::::');
				tc.util.dump(app_page);
				
				tc.app(app_page);
				
				/* DELETE THIS LATER!!!!!!! */
				$('.dev-util .toggle').click(function() {
				  $('.dev-util-content').toggle();
				});
				/* STOP DELETEING!!!!! */
			});
		</script>
		
		{% if d.template_data.app_env and d.template_data.app_env == 'live' %}
			<script type="text/javascript">
				
				var _gaq = _gaq || [];
				_gaq.push(['_setAccount', 'UA-22834983-1']);
				_gaq.push(['_trackPageview']);
				
				(function() {
					var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
					ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
					var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
				})();
				
			</script>
		{% endif %}
		
		{% block javascript_footer %}{% endblock %}
		
	</body>
	
</html>