<div class="box add-link" style="display:none;">
	<div class="hd clearfix">
		<h2>
			<span>
				Add a Link
			</span>
		</h2>
		<div class="actions">
			<a href="#hide,add_link" class="back fancy-caps">
				<span>Back <span>to</span> Project Home</span>
			</a>
		</div>
	</div>

	<div class="bd clearfix merlin add-link">
		<div class='step add-link-step'>
			<p>You can add links to blogs, news items, or one of our recommended links.</p>
			<form action='#' class="form-pane">
				<div class="fields">
					<div class="row">
						<input name='link-title' class='link-url link-title' type="text"></input>
					</div>
					<div class="row">
						<input name='link-url' class='link-url link-href' type="text"></input>
					</div>
				</div>
				<a href="#" class='submit rounded-button'>Add</a>
			</form>
			<div class='box link-to-facebook'>
				<a class='partner-link' href='http://www.facebook.com'><span>Facebook</span></a>
				<p>Create a <strong>Facebook group</strong> and link it here. You can have the option to make the feed from the group show up in your group as well.</p>
			</div>
			<div class='box link-to-kickstarter'>
				<a class='partner-link' href='http://www.kickstarter.com'><span>Kickstarter</span></a>
				<p><strong>Raise money</strong> for your project on Kickstarter.</p>
			</div>
			<div class='box link-to-meetup'>
				<a class='partner-link' href='http://www.meetup.com'><span>Meetup</span></a>
				<p>A popular way of <strong>managing complex groups</strong>.</p>
			</div>
		</div>
		
		<div class='step submit-link-step spinner-message'>
			<p>Thank you for submitting a link!</p>
			<p><img src='/static/images/loader32x32.gif' /></p>
		</div>
	</div>
</div>

<script>
	if(!tc){ var tc = {}; }
	if(!tc.gam){ tc.gam = {}; }
	if(!tc.gam.project_widgets){ tc.gam.project_widgets = {}; }
	
	tc.gam.project_widgets.add_link = function(project,dom,deps,options){
		var widget;
		tc.util.log("project.add_link");
		this.options = tc.jQ.extend({name:'add_link'},options);
		this.dom = dom; 
		widget = tc.gam.widget(this,project);
		this.handlers = {
			
		};
		
		this.components = {
			merlin:null
		}
		
		this.build_merlin = function(){
			if(this.components.merlin){
				return;
			}
			this.components.merlin = new tc.merlin(options.app,{
				name:'add-link',
				dom:dom.find('.merlin.add-link'),
				next_button:dom.find('a.submit'),
				first_step:'link-info',
				data:{
					project_id:null,
					title:null,
					url:null
				},
				steps:{
					'link-info':{
						selector:'.step.add-link-step',
						next_step:'link-submit',
						inputs:{
							title:{
								selector:'input.link-title',
								validators:['min-3','max-32','required'],
								hint:'Title'
							},
							url:{
								selector:'input.link-href',
								validators:['min-3','max-32','required','url'],
								hint:'URL'
							}
						},
						init:function(merlin,dom){
							merlin.current_step.inputs.title.dom.val('Title').removeClass('has-been-focused').removeClass('has-attempted-submit');
							merlin.current_step.inputs.url.dom.val('URL').removeClass('has-been-focused').removeClass('has-attempted-submit');
						},
						finish:function(merlin,dom){
							merlin.options.data = tc.jQ.extend(merlin.options.data,{
								project_id:merlin.app.app_page.data.project.project_id,
								title:merlin.current_step.inputs.title.dom.val(),
								url:merlin.current_step.inputs.url.dom.val()
							});
						}
					},
					'link-submit':{
						selector:'.step.submit-link-step',
						next_step:'goal-info',
						init:function(merlin,dom){
							tc.jQ.ajax({
								type:'POST',
								url:'/project/link/add',
								data:merlin.options.data,
								context:merlin,
								dataType:'text',
								success:function(data,ts,xhr){
									if(data == 'False'){
										return false;
									}
									tc.timer(1000,function(){
										window.location.hash = 'add-link,link-info';
									})
								}
							});
						}
					}
				}
			});
		};
		
		this.build_merlin();
		
		return {
			show:function(propagate){
				widget.show(propagate);
				window.location.hash = 'add-link,link-info';
			},
			hide:widget.hide
		};
	};
	
</script>