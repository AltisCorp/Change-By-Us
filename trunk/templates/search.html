{% extends "./partials/base.html" %}

{% block title %}
Change by Us NYC - Search Results
{% endblock title %}


{% block javascript_header %}
{{ super() }}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="/static/js/gam-map-style.js"></script>
<script type="text/javascript" src="/static/js/libs/infobox_packed.js"></script>
<script type="text/javascript">
	var nychoods = {{ d.template_data.locations_scored }};
	var max_score = {{ d.template_data.max_score }};
</script>
<script type="text/javascript" src="/static/js/tc.gam.map.js"></script>
<script type="text/javascript">
	app_page.features.push(initialize);
</script>
{% endblock %}<!--end javascript_header-->



{% block continent %}

<div class='continent search-results'>
	<div class='headlands clearfix'>
		<ul class="tabs">
			<li class="tab tab-map"><a href="#map">Map</a></li>
			<li class="tab tab-list active"><a href="#all">List</a></li>
		</ul>
		<form class="search-results-header" action="" method="GET">
			<label>Search results for:</label>
			<div class="form-tier west">
				<div class="search-terms-container">
					<input type="text" class="search-terms always-focused" value="{% if d.template_data.search_terms %}{{ d.template_data.search_terms }}{% endif %}"/> 
					<a class="clear-field" href=""></a>
				</div>
				<span class="in">in</span>
				<div class="search-hood-container">
					<input type='text' name='location-hood-enter' id='location-hood-enter' class='search-location location-group location-hood-enter always-focused' {% if d.template_data.search_location_id %}location_id="{{ d.template_data.search_location_id }}"{% endif %} value="All neighborhoods"/>
					<a class="clear-field" href=""></a>
					<div class="location-hood-list" style="display:none"><ul></ul></div>
				</div>
				<input type="submit" class="rounded-button search-submit" value="Search" />
			</div>
		</form>
	</div>
	
	<div class='midlands merlin clearfix'>
		
		<!-- LIST VIEW -->
		<div id="list-view" class="step">
			<div class="west sidebar">
				<a class="sidebar-item all active" href="#all"><span>All</span><span class="counter">{{ d.template_data.total_count.data.projects + d.template_data.total_count.data.ideas + d.template_data.total_count.data.resources }}</span></a>
				<a class="sidebar-item projects" href="#projects"><span>Projects</span><span class="counter">{{ d.template_data.total_count.data.projects }}</span></a>
				<a class="sidebar-item resources" href="#resources"><span>Resources</span><span class="counter">{{ d.template_data.total_count.data.resources }}</span></a>
				<a class="sidebar-item ideas" href="#ideas"><span>Ideas</span><span class="counter">{{ d.template_data.total_count.data.ideas }}</span></a>
			</div>
			<div class="east">
				
				
				<div class="box results-box results-projects clearfix {% if d.template_data.results.data.projects|length == 0 %}none-found{% endif %}">
					<div class="hd">
						<h2><span class="counter">{{ d.template_data.total_count.data.projects }}</span> Project{% if d.template_data.total_count.data.projects > 1 %}s{% endif %}</h2>
						{% if d.template_data.total_count.data.projects > 6 %}
						<span class="control see-all-control"><a href="#projects">See all <span class="sm-arrow-forward light"></span></a></span>
						{% endif %}
						
						<div class="pagination-controls">
							<span class="control">
								<a class="prev project-carousel-prev" href="#"><span class="sm-arrow-back light"></span><span>Previous</span></a>
								<span class="carousel-page-info">Page <span class='current_page_number'>1</span> of <span class='n_pages'>{{ d.template_data.total_count.data.projects // 6 }}</span></span>
								<a class="next project-carousel-next" href="#"><span>Next</span><span class="sm-arrow-forward light"></span></a>
							</span>
						</div>
						
					</div>
					<div class="bd">
						
						<div class="carousel project">
							<div class="scrollable">
								<ul class="items">
									
									
										<li class='project-carousel-item clearfix loaded'>
											{% if d.template_data.results.data.projects|length > 0 %}
											
											<table class="projects-list doublewide clearfix">
												<tbody>
													{% for project in d.template_data.results.data.projects %}
														{% if loop.index is odd %}
														<tr class="{% if loop.index > 6 %}hidden-result {% endif %}{% if loop.index == 5 %}last-initial-row{% endif %}">
														{% endif %}
															<td>
																{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}
																<a class="close delete-project" href="#removeProject,{{ project.project_id }}"><span>Close</span></a>
																{% endif %}
																<div class="thumb">
																	{% if project.image_id > -1 %}
																	<a href="/project/{{ project.project_id }}"><img width='50' height='50' src='/images/{{ project.image_id % 10 }}/{{ project.image_id }}.png' alt="" class='proj'/></a>
																	{% else %}
																	<img width='50' height='50' src="/static/images/thumb_genAvatar50.png" alt="" class="proj"/>
																	{% endif %}
																	<span class="overlay-tag"></span>
																	<span class="member-count">{{ project.num_members }}</span>
																</div>
																<div class="project-info">
																	<span class="link"><a href="/project/{{ project.project_id }}">{{ project.title|truncate(50) }}</a></span>
																	<span class="creator"><em>Created by </em> <a href="/useraccount/{{ project.owner.u_id }}">{{ project.owner.name }}</a></span>
																	<span class="description"><a href="/project/{{ project.project_id }}">{{ project.description|truncate(70) }}</a></span>
																</div>
															</td>
														{% if loop.index is even %}
														</tr>
														{% endif %}
													{% endfor %}
												</tbody>
											</table>
											
											{% else %}
											
											<div class="none-found-message clearfix">
												<h2>There were <span class="counter">0</span> <strong>Projects</strong> found</h2>
												{% if d.template_data and d.template_data.user %}
												<a class="rounded-button small fancy-caps more-link" href="/create">Start <span>a</span> Project <span class="sm-arrow-forward"></span></a>
												{% endif %}
											</div>
											
											{% endif %}
										</li>
									
										<li class='project-carousel-item clearfix spinner-message'>
											<div class="spinner-container"></div>
										</li>
									
								</ul>
							</div>
						</div>
						
					</div>
					<div class="ft">
						{% if d.template_data and d.template_data.user %}
						<a class="rounded-button small fancy-caps more-link" href="/create">Start <span>a</span> Project <span class="sm-arrow-forward"></span></a>
						{% endif %}
						<!-- <div class="pagination-controls">
													<span class="control">
														<a class="prev project-carousel-prev" href="#"><span class="sm-arrow-back light"></span><span>Previous</span></a>
														<span class="carousel-page-info">Page <span class='current_page_number'>1</span> of <span class='n_pages'>{{ d.template_data.total_count.data.projects // 6 }}</span></span>
														<a class="next project-carousel-next" href="#"><span>Next</span><span class="sm-arrow-forward light"></span></a>
													</span>
												</div> -->
					</div>
				</div><!-- end results-box -->
				
				
				
				
				<div class="box results-box results-resources clearfix {% if d.template_data.total_count.data.resources == 0 %}none-found{% endif %}">
					
					<div class="hd">
						<h2><span class="counter">{{ d.template_data.total_count.data.resources }}</span> Resource{% if d.template_data.total_count.data.resources > 1 %}s{% endif %}</h2>
						{% if d.template_data.total_count.data.resources > 6 %}
						<span class="see-all-control control"><a href="#resources">See all <span class="sm-arrow-forward light"></span></a></span>
						{% endif %}
						
						<div class="pagination-controls">
							<span class="control">
								<a class="prev resource-carousel-prev" href="#"><span class="sm-arrow-back light"></span><span>Previous</span></a>
								<span class="carousel-page-info">Page <span class='current_page_number'>1</span> of <span class='n_pages'>{{ d.template_data.total_count.data.resources // 6 }}</span></span>
								<a class="next resource-carousel-next" href="#"><span>Next</span><span class="sm-arrow-forward light"></span></a>
							</span>
						</div>
						
					</div>
					
					<div class="bd">
						
						<div class="carousel resource">
							<div class="scrollable">
								<ul class="items">
						
									<li class='resource-carousel-item clearfix loaded'>
										{% if d.template_data.total_count.data.resources > 0 %}
										<table class="resources-list triplewide clearfix">
											<tbody>
												{% for resource in d.template_data.results.data.resources %}
													{% if loop.index % 3 == 1 %}
													<tr class="{% if loop.index > 6 %}hidden-result {% endif %}{% if loop.index == 4 %}last-initial-row{% endif %}">
													{% endif %}
														<td>
															{% if d.template_data and d.template_data.user and d.template_data.user.data.projects|length > 0 %}
																<a class="add-button rounded-button small add-resource" href="#addProject,{{ resource.link_id }}">Add</a>
															{% endif %}
															{% if resource.image_id > -1 %}
																<span class="thumb">{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}<a class="close delete-resource" href="#removeResource,{{ resource.link_id }}"><span>Close</span></a>{% endif %}<img width='35' height='35' src='/images/{{ resource.image_id % 10 }}/{{ resource.image_id }}.png' alt="" /></span>
															{% else %}
																<span class="thumb">{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}<a class="close delete-resource" href="#removeResource,{{ resource.link_id }}"><span>Close</span></a>{% endif %}<img width='35' height='35' src='/static/images/thumb_genAvatar50.png' alt="" /></span>
															{% endif %}
															<span class="resource-name">
																<span rel="#organization,{{ resource.link_id }}" class='resource-tooltip_trigger tooltip_trigger'>
																	<span><a target='_blank' href="{{ resource.url }}"><span>{{ resource.title|truncate(30, true) }}</span></a></span>
																</span>
															</span>
															<div class="added-dialog">
																<span class="added-header">Added <em>to</em> your project<br /></span>
																<span class="added-text">We've sent them a link to your project page. <a href="">?</a></span>
																<!-- <span class="added-close"></span> -->
															</div>
														</td>
													{% if loop.index % 3 == 0 %}
													</tr>
													{% endif %}
												{% endfor %}
											</tbody>
										</table>
										{% else %}
										<div class="none-found-message clearfix">
											<h2>There were <span class="counter">0</span> <strong>Resources</strong> found</h2>
											<a class="rounded-button small fancy-caps more-link" href="/resource">Add <span>your</span> Resource <span class="sm-arrow-forward"></span></a>
										</div>
										{% endif %}
									</li>
									
									<li class='resource-carousel-item clearfix spinner-message'>
										<div class="spinner-container"></div>
									</li>
									
								</ul>
							</div>
						</div>
						
					</div>
					
					<div class="ft">
						<a class="rounded-button small fancy-caps more-link" href="/resource">Add <span>your</span> Resource <span class="sm-arrow-forward"></span></a>
						
						<!-- <div class="pagination-controls">
													<span class="control">
														<a class="prev resource-carousel-prev" href="#"><span class="sm-arrow-back light"></span><span>Previous</span></a>
														<span class="carousel-page-info">Page <span class='current_page_number'>1</span> of <span class='n_pages'>{{ d.template_data.total_count.data.resources // 6 }}</span></span>
														<a class="next resource-carousel-next" href="#"><span>Next</span><span class="sm-arrow-forward light"></span></a>
													</span>
												</div> -->
					</div>
				
				</div><!-- end results-box -->
				
				
				
				
				
				
				<div class="box results-box results-ideas clearfix {% if d.template_data.total_count.data.ideas == 0 %}none-found{% endif %}">
					
					<div class="hd">
						<h2><span class="counter active">{{ d.template_data.total_count.data.ideas }}</span> Idea{% if d.template_data.total_count.data.ideas > 1 %}s{% endif %}</h2>
						{% if d.template_data.total_count.data.ideas > 3 %}
						<span class="see-all-control control"><a href="#ideas">See all <span class="sm-arrow-forward light"></span></a></span>
						{% endif %}
						<div class="pagination-controls">
							<span class="control">
								<a class="prev idea-carousel-prev" href="#"><span class="sm-arrow-back light"></span><span>Previous</span></a>
								<span class="carousel-page-info">Page <span class='current_page_number'>1</span> of <span class='n_pages'>{{ d.template_data.total_count.data.ideas // 6 }}</span></span>
								<a class="next idea-carousel-next" href="#"><span>Next</span><span class="sm-arrow-forward light"></span></a>
							</span>
						</div>
					</div>
					
					<div class="bd">
						
						<div class="carousel idea">
							<div class="scrollable">
								<ul class="items">
						
									<li class='idea-carousel-item clearfix loaded'>
										{% if d.template_data.total_count.data.ideas > 0 %}
										<ul class="ideas-list clearfix">
											{% for idea in d.template_data.results.data.ideas %}
												<li class="{% if loop.index % 3 == 0  %}every-third {% endif %}{% if loop.index > 3 %}hidden-result{% endif %}">
													{% if d.template_data and d.template_data.user %}
													<div class="note-card-public-controls">
														{% if d.template_data.user.data.projects|length > 0 %}
															<a class="invite rounded-button small" href="#invite,{{ idea.idea_id }},{{ idea.owner.name }}">Invite</a>
														{% endif %}
														<span class="flag"><a href="#flagIdea,{{ idea.idea_id }}" class='flag-idea'>Flag as Inappropriate</a></span>
													</div>
													{% endif %}
													<div class="note-card">
														<div class="membrane">
															{% if d.template_data and d.template_data.user %}
																{% if d.template_data.user.is_admin or d.template_data.user.data.u_id == idea.owner.u_id %}
																<a class="close remove-idea" href="#removeIdea,{{ idea.idea_id }}"><span>Close</span></a>
																{% endif %}
															{% endif %}
															{% if idea.owner %}<cite class="note-meta-hd"><strong>
																<a href="/useraccount/{{ idea.owner.u_id }}">{{ idea.owner.name|truncate(18) }}</a>
															</strong> said &mdash;</cite>{% endif %}
															<blockquote>{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}{% if not idea.owner.name %}<span class="topright-spacer"></span>{% endif %}{% endif %}<p>{{ idea.message|truncate(165) }}</p></blockquote>
															<cite class="note-meta-ft">Posted <strong class="time-since">{{ idea.created }}</strong> via <strong>{{ idea.submission_type }}</strong></cite>
														</div>
													</div>
												</li>
											{% endfor %}
										</ul>
										{% else %}
										<div class="none-found-message clearfix">
											<h2>There were <span class="counter">0</span> <strong>Ideas</strong> found</h2>
											<a class="rounded-button small fancy-caps more-link" href="/">Add <span>an</span> Idea <span class="sm-arrow-forward"></span></a>
										</div>
										{% endif %}
									</li>
									
									<li class='idea-carousel-item clearfix spinner-message'>
										<div class="spinner-container"></div>
									</li>
									
								</ul>
							</div>
						</div>
					</div>
					
					<div class="ft">
						<a class="rounded-button small fancy-caps more-link" href="/">Add <span>an</span> Idea <span class="sm-arrow-forward"></span></a>
						<!-- <div class="pagination-controls">
													<span class="control">
														<a class="prev idea-carousel-prev" href="#"><span class="sm-arrow-back light"></span><span>Previous</span></a>
														<span class="carousel-page-info">Page <span class='current_page_number'>1</span> of <span class='n_pages'>{{ d.template_data.total_count.data.ideas // 6 }}</span></span>
														<a class="next idea-carousel-next" href="#"><span>Next</span><span class="sm-arrow-forward light"></span></a>
													</span>
												</div> -->
					</div>
				</div><!-- end results-box -->
				
				
			</div><!--end .east -->
		</div><!-- end #list-view-->
		
		
		
		
		
		
		
		
		
		
		
		
		
		<div id="map-view" class="step" style="display:none">
			<div class="map-results clearfix">
				<div class="box results-box results-projects">
					<div class="hd">
						<h2><span class="uncaps">Citywide</span> Projects <span class="counter">{{ d.template_data.results.data.projects|length }}</span></h2>
						{% if d.template_data.results.data.projects|length > 0 %}
						<span class="control"><a href="#projects">See all <span class="sm-arrow-forward light"></span></a></span>
						{% endif %}
					</div>
					<div class="bd">
						{% if d.template_data.results.data.projects|length > 0 %}
						<table class="projects-list doublewide clearfix">
							<tbody>
								{% for project in d.template_data.results.data.projects %}
									{% if loop.index < 3 %}
										{% if loop.index is odd %}
										<tr>
										{% endif %}
											<td>
												{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}
												<a class="close" href="#"><span>Close</span></a>
												{% endif %}
												<div class="thumb">
													{% if project.image_id > -1 %}
													<a href="/project/{{ project.project_id }}"><img width='50' height='50' src='/images/{{ project.image_id % 10 }}/{{ project.image_id }}.png' alt="" class='proj'/></a>
													{% else %}
													<img width='50' height='50' src="/static/images/thumb_genAvatar50.png" alt="" class="proj"/>
													{% endif %}
													<span class="overlay-tag"></span>
													<span class="member-count">{{ project.num_members }}</span>
												</div>
												<div class="project-info">
													<span class="link"><a href="/project/{{ project.project_id }}">{{ project.title|truncate(50) }}</a></span>
													<span class="creator"><em>Created by </em> <a href="/useraccount/{{ project.owner.u_id }}">{{ project.owner.name }}</a></span>
													<span class="description"><a href="/project/{{ project.project_id }}">{{ project.description|truncate(70) }}</a></span>
												</div>
											</td>
										{% if loop.index is even %}
										</tr>
										{% endif %}
									{% endif %}
								{% endfor %}
							</tbody>
						</table>
						{% endif %}
					</div>
				</div>
				
				<div class="box results-box results-resources">
					<div class="hd">
						<h2><span class="uncaps">Citywide</span> Resources <span class="counter">{{ d.template_data.total_count.data.resources }}</span></h2>
						{% if d.template_data.total_count.data.resources > 0 %}
						<span class="control"><a href="#resources">See all <span class="sm-arrow-forward light"></span></a></span>
						{% endif %}
					</div>
					<div class="bd">
						{% if d.template_data.total_count.data.resources > 0 %}
						<table class="resources-list clearfix">
							<tbody>
								<tr>
									{% for resource in d.template_data.results.data.resources %}
										{% if loop.index < 2 %}
										<td>
											{% if d.template_data and d.template_data.user and d.template_data.user.data.projects|length > 0 %}
												<a href="#addProject,{{ resource.link_id }}" class="add-button rounded-button small">Add</a>
											{% endif %}
											{% if resource.image_id > -1 %}
											<span class="thumb">{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}<a class="close" href="#"><span>Close</span></a>{% endif %}<img width='35' height='35' src='/images/{{ resource.image_id % 10 }}/{{ resource.image_id }}.png' alt="" /></span>
											{% else %}
											<span class="thumb">{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}<a class="close" href="#"><span>Close</span></a>{% endif %}<img width='35' height='35' src='/static/images/thumb_genAvatar50.png' alt="" /></span>
											{% endif %}
											<span rel="#organization,{{ resource.link_id }}" class='resource-tooltip_trigger resource-name tooltip_trigger'>
												<span><a target='_blank' href="{{ resource.url }}"><span>{{ resource.title|truncate(30) }}</span></a></span>
											</span>
											<div class="added-dialog">
												<span class="added-header">Added <em>to</em> your project<br /></span>
												<span class="added-text">We've sent them a link to your project page. <a href="">?</a></span>
												<!-- <span class="added-close"></span> -->
											</div>
										</td>
										{% endif %}
									{% endfor %}
								<tr>
							</tbody>
						</table>
						{% endif %}
					</div>
				</div>
			</div><!-- end map-results-->
			
			
			<div class="box results-map themap">
				<div id="map_canvas"></div>
				<!--<iframe src="/search/map" style="width: 960px; height: 545px"></iframe>-->
			</div>
			
			
		</div><!-- end #map-view -->
		
		
		
		
		
	</div>

	<div class='foothills'>

	</div>

	<div class="template-content modal-content confirm-delete remove-resource">
		<div class="step">
			<h2><strong>Delete</strong> this Resource?</h2>
			<div>
				<p>You are about to delete this Resource from the system permanently! <br/>Are you sure?</p>
			</div>
			<div class="actions">
				<a class="submit rounded-button" href="#">Yes, Delete Resource</a>
				<a class="cancel" href="#">No, keep them.</a>
			</div>
		</div>
		<a class='close' href="#"><span>close</span></a>
	</div>
	
	
	<div class='template-content modal-content merlin add-resource'>
			
			<div class="step add-resource-project-info">
				<h2>Add a <strong><span class="name">Resource</span></strong></h2>
				<p class="no-name">Which project would you like to add this to?</p>
				<form action='#' class="form-pane non-float checklist">
					<div class="fields">
						{% if d.template_data and d.template_data.user %}
							{% if d.template_data.user.data.projects|length > 0 %}
								{% for project in d.template_data.user.data.projects %}
									<div class="row">
										<input type="radio" class="project-radio" rel="#project,{{ project.project_id }}" id="invite-project-{{ project.project_id }}" name="invite-project-name" />
										<label for="invite-project-{{ project.project_id }}">{{ project.title }}</label>
									</div>
								{% endfor %}
							{% else %}
							
							{% endif %}
						{% endif %}
					</div>
					<a class='submit rounded-button' href="#">Add</a>
				</form>
			</div>
			
			<div class='step add-resource-submit spinner-message'>
				<p>Thanks for adding a resource to your project!</p>
				<p><img src='/static/images/loader32x32.gif' /></p>
			</div>
			
			<a class='close' href="#"><span>close</span></a>
		</div>
	
	<div class='template-content' id='organization-markup-source'>
		<div class='tooltip-hd'>
			<h2></h2>
		</div>
		<div class='tooltip-bd'>
			<div class='info'>
				<div class='thumb'>
					<img width='90' alt='' src='http://placehold.it/90x90'/>
				</div>
				<div class='main'>
					<p></p>
				</div>
			</div>
			<dl class='details'>
				<dt>Visit Us</dt>
				<dd><a href=''></a></dd>
			</dl>
		</div>
	</div>
	
	<div class="template-content modal-content confirm-delete project-delete">
		<div class="step">
			<h2><strong>Delete</strong> this Project?</h2>
			<div>
				<p>You are about to delete this project from the system permanently! <br/>Are you sure?</p>
			</div>
			<div class="actions">
				<a class="submit rounded-button" href="#">Yes, Delete Project</a>
				<a class="cancel" href="#">No, keep them.</a>
			</div>
		</div>
		<a class='close' href="#"><span>close</span></a>
	</div>
	
	<div class='template-content project-cell'>
		{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}
		<a class="close delete-project" href="#removeProject,"><span>Close</span></a>
		{% endif %}
		
		<div class="thumb">
			<img width='50' height='50' src="/static/images/thumb_genAvatar50.png" alt="" class="proj"/>
			<span class="overlay-tag"></span>
			<span class="member-count"></span>
		</div>
		<div class="project-info">
			<span class="link"><a href="/project/"></a></span>
			<span class="creator"><em>Created by </em> <a href="/useraccount/"></a></span>
			<span class="description"><a href="/project/"></a></span>
		</div>
	</div>
	
	<div class='template-content resource-cell'>
		{% if d.template_data and d.template_data.user and d.template_data.user.data.projects|length > 0 %}
			<a class="add-button rounded-button small add-resource" href="#addProject,">Add</a>
		{% endif %}
		
		<span class="thumb">{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}<a class="close delete-resource" href="#removeResource,"><span>Close</span></a>{% endif %}<img width='35' height='35' src='/static/images/thumb_genAvatar50.png' alt="" /></span>
		<span class="resource-name">
			<span rel="#organization," class='resource-tooltip_trigger tooltip_trigger'>
				<span><a target='_blank' href="" class='resource_link'><span></span></a></span>
			</span>
		</span>
		<div class="added-dialog">
			<span class="added-header">Added <em>to</em> your project<br /></span>
			<span class="added-text">We've sent them a link to your project page. <a href="">?</a></span>
			<!-- <span class="added-close"></span> -->
		</div>
	</div>
	
	<div class='template-content idea-cell'>
		{% if d.template_data and d.template_data.user %}
		<div class="note-card-public-controls">
			{% if d.template_data.user.data.projects|length > 0 %}
				<a class="invite rounded-button small" href="#invite,,">Invite</a>
			{% endif %}
			<span class="flag"><a href="#flagIdea," class='flag-idea'>Flag as Inappropriate</a></span>
		</div>
		{% endif %}
		<div class="note-card">
			<div class="membrane">
				{% if d.template_data and d.template_data.user %}
					{% if d.template_data.user.is_admin %}
					<a class="close remove-idea" href="#removeIdea,"><span>Close</span></a>
					{% endif %}
				{% endif %}
				<cite class="note-meta-hd"><strong>
					<a class='user-link' href="/useraccount/"></a>
				</strong> said &mdash;</cite>
				<blockquote>{% if d.template_data and d.template_data.user and d.template_data.user.is_admin %}{% endif %}<p class='idea-text'></p></blockquote>
				<cite class="note-meta-ft">Posted <strong class="time-since"></strong> via <strong class='sub-type'></strong></cite>
			</div>
		</div>
	</div>
	
</div>

{% endblock continent %}

{% block page_js %}
<script type="text/javascript">
	tc.util.dump('Search Data');
	{% if 1==0 %}tc.util.dump({{ d.template_data.results['json'] }});{% endif %}
</script>

<script type="text/javascript">
	app_page.features.push(function(app){
		tc.util.log('Give A Minute: Search');
		
		function changeListCat(theCat) {
			tc.jQ('.results-box').removeClass('single');
			tc.jQ('ul.tabs .tab-map').removeClass('active');
			tc.jQ('ul.tabs .tab-list').addClass('active');
			tc.jQ('.sidebar').children('.sidebar-item').removeClass('active');
			tc.jQ('.sidebar').children('.'+theCat).addClass('active');
			tc.jQ('#list-view').removeClass('all projects resources ideas').addClass(theCat);
			tc.jQ('.results-'+theCat).addClass('single').find('.carousel').trigger('make-single');
			tc.jQ('.results-box').not('.single').find('.carousel').trigger('make-multiple');
		};
		
		tc.jQ('.search-terms-container a.clear-field').bind('click',{input:tc.jQ('input.search-terms')},function(e){
			e.preventDefault();
			e.data.input.val('').trigger('change');
		});
		
		tc.jQ('.search-hood-container a.clear-field').bind('click',{input:tc.jQ('input.location-hood-enter')},function(e){
			e.preventDefault();
			e.data.input.attr('location_id','-1').val('All neighborhoods').trigger('change');
		});
		
		tc.jQ('input.search-terms, input.search-location').bind('change', {}, function(e){
			if(e.target.value.length == 0 || (e.target.className.indexOf('search-location') != -1 && e.target.value == 'All neighborhoods')){
				tc.jQ(this).siblings('a.clear-field').hide();
			} else {
				tc.jQ(this).siblings('a.clear-field').show();
			}
		}).trigger('change');
		
		
		tc.jQ('input.search-submit').bind('click',{terms:tc.jQ('input.search-terms'),location:tc.jQ('input.location-hood-enter')},function(e){
			e.preventDefault();
			//if(e.data.terms.val().length){
				if(e.data.location.attr('location_id')){
					window.location = '/search?terms='+e.data.terms.val()+'&location_id='+e.data.location.attr('location_id');
				} else {
					window.location = '/search?terms='+e.data.terms.val();
				}
			//}
		});
		
		new tc.locationDropdown({
			input:tc.jQ('input.location-hood-enter'),
			list:tc.jQ('div.location-hood-list'),
			locations:app.app_page.data.locations
		});
		
		function build_carousel(app,name,data){
			var mycarousel, data, fn;
			
			mycarousel = app.components[name+'_carousel'];
			
			if(mycarousel && mycarousel.carousel){
				return;
			}
				
			app.components[name+'_carousel'] = new tc.carousel({
				element: tc.jQ("."+name+".carousel"),
				next_button: tc.jQ('.'+name+'-carousel-next'),
				prev_button: tc.jQ('.'+name+'-carousel-prev'),
				scrollable: {
					items: ".items",
					speed: 300,
					circular: false
				}
			});
			
			mycarousel = app.components[name+'_carousel'];
			
			
			if(!mycarousel.carousel){
				tc.jQ("."+name+".carousel").one('make-single make-multiple',{app:app},function(e){
					build_carousel(e.data.app);
				});
				app.components[name+'_carousel'] = null;
				mycarousel = null;
			} else {
				
				app.components[name+'_carousel'].data = data;
				
				tc.jQ("."+name+".carousel").bind('make-single make-multiple',{app:app, carousel:mycarousel},function(e){
					var target_height;
					target_height = tc.jQ(e.data.carousel.carousel.getItems()[e.data.carousel.carousel.getIndex()]).height()+'px';
					e.data.carousel.get_element().css('height',target_height).children('.scrollable').css('height',target_height);
				});
				
				mycarousel.carousel.getRoot().unbind('onSeek').bind('onSeek', {app:app, carousel:mycarousel}, function(e,d){
					e.data.carousel.data.current_page = e.data.carousel.carousel.getItems().eq(e.data.carousel.carousel.getIndex());
					e.data.carousel.get_element().parent().parent().find('.current_page_number').text(e.data.carousel.carousel.getIndex()+1);
					
					if(!e.data.carousel.data.current_page.hasClass('loaded')){
						e.data.carousel.data.current_page.addClass('loaded');
						tc.jQ.ajax({
							type:"GET",
							url:"/search/"+name+"s",
							data:{ 
								location_id: e.data.carousel.data.location_input.attr('location_id'),
								terms: e.data.carousel.data.terms_input.val(),
								n: e.data.carousel.data.n_to_fetch,
								offset: e.data.carousel.data.offset
							},
							context:e.data.app,
							dataType:"text",
							success: function(data, ts, xhr) {
								var d, target_height;
								try {
									d = tc.jQ.parseJSON(data);
								} catch(e) {
									tc.util.log("/search/"+name+"s: json parsing error", "warn");
									return;
								}
								
								e.data.carousel.data.current_page.removeClass('spinner-message').children().remove();
								
								if(!d.results.length && e.data.carousel.data.offset > 0){
									e.data.carousel.data.current_page.remove();
									return;
								}
								
								e.data.carousel.data.offset += d.results.length;
								
								if(d.results.length == e.data.carousel.data.n_to_fetch){
									e.data.carousel.carousel.addItem('\
										<li class="project-carousel-item clearfix spinner-message">\
											<div class="spinner-container"></div>\
										</li>');
								}
								
								e.data.carousel.data.current_page.append(e.data.carousel.data.page_generator(d));
								target_height = tc.jQ(e.data.carousel.carousel.getItems()[e.data.carousel.carousel.getIndex()]).height()+'px';
								e.data.carousel.get_element().css('height',target_height).children('.scrollable').css('height',target_height);
							}
						});
					} else {
						var target_height;
						target_height = tc.jQ(e.data.carousel.carousel.getItems()[e.data.carousel.carousel.getIndex()]).height()+'px';
						e.data.carousel.get_element().css('height',target_height).children('.scrollable').css('height',target_height);
					}
					
				});
				mycarousel.carousel.begin();
			}
			
		};
		
		build_carousel(app, 'project', {
			current_section:null,
			current_page:null,
			n_to_fetch: 6,
			offset:6,
			location_input:tc.jQ('#location-hood-enter'),
			terms_input:tc.jQ('input.search-terms'),
			page_generator:function(d){
				var out, i, temprow, tempcell;
				out = tc.jQ('<table class="projects-list doublewide clearfix">\
					<tbody></tbody>\
				</table>');
				
				for(i = 0; i < d.results.length; i++){
					if(i%2==0){
						temprow = tc.jQ('<tr></tr>');
					}
					tempcell = tc.jQ('<td></td>').append(tc.jQ('.template-content.project-cell').html());
					tempcell.find('.delete-project').attr('href','#removeProject,'+d.results[i].project_id);
					tempcell.find('img');
					tempcell.find('.member-count').text(d.results[i].num_members);
					tempcell.find('.link').children('a').attr('href','/project/'+d.results[i].project_id).text(d.results[i].title);
					
					tempcell.find('.creator').children('a').attr('href','/useraccount/'+d.results[i].owner.u_id).text(d.results[i].owner.name);
					tempcell.find('.description').children('a').attr('href','/project/'+d.results[i].project_id).text(d.results[i].description);
					
					temprow.append(tempcell);
					if(i%2==1){
						out.children('tbody').append(temprow);
					}
				}
				
				out.find('a.delete-project').bind('click',{app:app},app.components.handlers.delete_project_handler);
				
				return out;
			}
		});
		
		build_carousel(app, 'resource', {
			current_section:null,
			current_page:null,
			n_to_fetch: 6,
			offset:6,
			location_input:tc.jQ('#location-hood-enter'),
			terms_input:tc.jQ('input.search-terms'),
			page_generator:function(d){
				var out, i, temprow, tempcell;
				out = tc.jQ('<table class="resources-list triplewide clearfix">\
					<tbody></tbody>\
				</table>');
				
				for(i = 0; i < d.results.length; i++){
					if(i%3==0){
						temprow = tc.jQ('<tr></tr>');
					}
					tempcell = tc.jQ('<td></td>').append(tc.jQ('.template-content.resource-cell').html());
					
					tempcell.find('.add-button').attr('href','#addProject,'+d.results[i].link_id);
					if(d.results[i].image_id){
						tempcell.find('img').attr('src','/images/'+(d.results[i].image_id%10)+'/'+d.results[i].image_id+'.png')
					}
					tempcell.find('.resource-tooltip_trigger').attr('rel','#organization,'+d.results[i].link_id);
					tempcell.find('a.resource_link').attr('href',d.results[i].url).children('span').text(tc.truncate(d.results[i].title,28,'...'));
					
					temprow.append(tempcell);
					if(i%3==1){
						out.children('tbody').append(temprow);
					}
				}
				
				out.find('a.add-resource').bind('click',app.components.handlers.add_resource_data,app.components.handlers.add_resource_hander);
				out.find('a.delete-resource').bind('click', {app:app}, app.components.handlers.delete_resource_handler);
				app.components.tooltips.add_trigger(out.find('.resource-tooltip_trigger'));
				
				return out;
			}
		});
		
		build_carousel(app, 'idea', {
			current_section:null,
			current_page:null,
			n_to_fetch: 6,
			offset:6,
			location_input:tc.jQ('#location-hood-enter'),
			terms_input:tc.jQ('input.search-terms'),
			page_generator:function(d){
				var out, i, temprow, tempcell;
				out = tc.jQ('<ul class="ideas-list clearfix"></ul>');
				
				for(i = 0; i < d.results.length; i++){
					tempcell = tc.jQ('<li></li>').append(tc.jQ('.template-content.idea-cell').html());
					
					if(d.results[i].owner){
						tempcell.find('.invite').attr('href','#invite,'+d.results[i].idea_id+','+d.results[i].owner.u_id);
						tempcell.find('.user-link').attr('href','/useraccount/'+d.results[i].owner.u_id).text(d.results[i].owner.name);
					}
					tempcell.find('.flag-idea').attr('href','#flagIdea,'+d.results[i].idea_id);
					tempcell.find('.remove-idea').attr('href','#removeIdea,'+d.results[i].idea_id);
					
					tempcell.find('.idea-text').text(d.results[i].message);
					tempcell.find('.time-since').text(d.results[i].created);
					tempcell.find('.sub-type').text(d.results[i].submssion_type);
					
					out.append(tempcell);
				}
				
				out.find('a.flag-idea').bind('click', {app:app}, app.components.handlers.flag_idea_handler);
				out.find('a.remove-idea').bind('click', {app:app}, app.components.handlers.remove_idea_handler);
				
				return out;
			}
		});
		
		
		app.components.merlin = new tc.merlin(app,{
			dom:tc.jQ('.merlin'),
			first_step:'all',
			allow_hash_override_onload:true,
			steps:{
				'all':{
					selector:'#list-view',
					init:function(merlin,dom){
						changeListCat('all')
					}
				},
				'projects':{
					selector:'#list-view',
					init:function(merlin,dom){
						changeListCat('projects');
					}
				},
				'resources':{
					selector:'#list-view',
					init:function(merlin,dom){
						changeListCat('resources');
					}
				},
				'ideas':{
					selector:'#list-view',
					init:function(merlin,dom){
						changeListCat('ideas');
					}
				},
				'map':{
					selector:'#map-view',
					init:function(merlin,dom){
						google.maps.event.trigger(map, 'resize');
						map.setCenter(brooklyn);
						tc.jQ('ul.tabs .tab-list').removeClass('active');
						tc.jQ('ul.tabs .tab-map').addClass('active');
					}
				}
			}
		});
		
		app.components.tooltips = tc.resource_tooltip({
			triggers: tc.jQ(".resource-tooltip_trigger"),
			trigger_class:'resource-tooltip_trigger',
			markup_source_element: tc.jQ('#organization-markup-source'),
			get_url: "/project/resource/info"
		});
		
		tc.gam.ideas_invite( app );
		
		
		app.components.handlers = {
			add_resource_data:{
				app:app,
				source_element:tc.jQ('.modal-content.add-resource'),
				init:function(modal,event_target,callback){
					var modal_merlin;
					modal_merlin = new tc.merlin(app,{
						name:'add-resource',
						dom:modal.options.element.find('.add-resource'),
						next_button: tc.jQ('a.submit'),
						first_step: 'add-resource-project-info',
						data:{
							project_id: null,
							project_resource_id: null
						},
						steps:{
							'add-resource-project-info':{
								selector:'.add-resource-project-info',
								next_step:'add-resource-submit',
								inputs:{
									project_radios:{
										selector:'.project-radio',
										vallidators:['required']
									}
								},
								init: function(merlin, dom) {
									var name;
								
									dom.find('input[type=checkbox],input[type=radio]').prettyCheckboxes();
								
									if(dom.find('.project-radio').length == 1){
										dom.find('.project-radio').first().attr('checked',true);
										//window.location.hash = 'add-resource,add-resource-submit';
									}
							
								},
								finish: function(merlin, dom) {
									if(merlin.current_step.inputs.project_radios.dom.filter(":checked").length){
										merlin.options.data = tc.jQ.extend(merlin.options.data, {
											project_id: merlin.current_step.inputs.project_radios.dom.filter(":checked").attr("rel").split(",")[1],
											project_resource_id: event_target.hash.split(',')[1]
										});
									}
								}
							},
							'add-resource-submit':{
								selector:'.add-resource-submit',
								init: function(merlin, dom) {
								
								
									tc.jQ.ajax({
										type:"POST",
										url:"/project/resource/add",
										data:merlin.options.data,
										context:merlin,
										dataType:"text",
										success: function(data, ts, xhr) {
											//if (data == "False") {
											//	return false;
											//}
											//tc.jQ(event_target).addClass("disabled").text("Added");
											tc.jQ(event_target).parents('td').addClass('added');
											tc.timer(1000, function() {
												modal.hide();
											});
										}
									});
								}
							}
						}
					});
					if(tc.jQ.isFunction(callback)){
						callback(modal);
					}
				}
			},
			add_resource_hander:function(e,d){
				e.preventDefault();
				e.data.app.components.modal.show(e.data, e.target);
			},
			flag_idea_handler:function(e){
				e.preventDefault();
				tc.jQ.ajax({
					type:"POST",
					url:'/idea/flag',
					data:{
						idea_id:e.target.hash.split(',')[1]
					},
					context:tc.jQ(e.target),
					dataType:"text",
					success: function(data, ts, xhr) {
						if (data == "False") {
							return false;
						}
						this.parent().text('Flagged');
					}
				});
			},
			remove_idea_handler:function(e){
				e.preventDefault();
				var $t;
				$t = tc.jQ(e.target);
				e.data.app.components.modal.show({
					app:e.data.app,
					source_element:tc.jQ('.modal-content.remove-idea'),
					submit:function(){
						tc.jQ.ajax({
							type:'POST',
							url:'/idea/remove',
							data:{
								idea_id: e.target.hash.split(',')[1]
							},
							context:$t,
							dataType:'text',
							success:function(data,ts,xhr){
								if(data == 'False'){
									return false;
								}
								this.parents('.results-ideas').find('.counter.active').text((Number(this.parents('.results-ideas').find('.counter.active').text()) - 1));
								this.parent().parent().parent().animate({
									width:0
								}, 400, 'easeOutCubic', function(e,d){
									tc.jQ(this).hide();
								}).remove();
								tc.jQ('ul.ideas-list li').removeClass('every-third').filter(function(index) {
						 			return index % 3 == 2;
								}).addClass('every-third');
								tc.jQ('ul.ideas-list li').eq(2).removeClass('hidden-result');
							}
						});
					}
				});
			},
			delete_resource_handler:function(e){
				e.preventDefault();
				var $t;
				$t = tc.jQ(e.target);
				e.data.app.components.modal.show({
						app:e.data.app,
						source_element:tc.jQ('.modal-content.remove-resource'),
						submit:function(){
							tc.jQ.ajax({
								type:'POST',
								url:'/admin/resource/delete',
								data:{
									resource_id: e.target.hash.split(',')[1]
								},
								context:$t,
								dataType:'text',
								success:function(data,ts,xhr){
									location.reload(true);
								}
							});
						}
					});
			},
			delete_project_handler:function(e,d){
				var t;
				e.preventDefault();
				t = e.target;
				if(t.nodeName == 'SPAN'){
					t = t.parentNode;
				}
				e.data.app.components.modal.show({
					app:app,
					source_element:tc.jQ('.modal-content.project-delete'),
					submit:function(modal,callback){
						tc.jQ.ajax({
							type:'POST',
							url:'/admin/project/delete',
							data:{
								project_id:t.hash.split(',')[1]
							},
							context:app,
							dataType:'text',
							success:function(data,ts,xhr){
								location.reload(true);
							}
						});
					}
				});
			}
		};
		
		
		tc.jQ('a.add-resource').bind('click',app.components.handlers.add_resource_data,app.components.handlers.add_resource_hander);
		tc.jQ('a.flag-idea').bind('click', {app:app}, app.components.handlers.flag_idea_handler);
		tc.jQ('a.remove-idea').bind('click', {app:app}, app.components.handlers.remove_idea_handler);
		tc.jQ('a.delete-resource').bind('click', {app:app}, app.components.handlers.delete_resource_handler);
		tc.jQ('a.delete-project').bind('click',{app:app},app.components.handlers.delete_project_handler);
		
		// turn location field autocomplete off
		tc.jQ('#location-hood-enter').attr('autocomplete', 'off');
		
		// random note-card backgrounds
		var ideasList = tc.jQ('.ideas-list li');
		for (i=0; i < ideasList.length; i++) {
			ideasList.eq(i).children('.note-card').addClass('card' + (Math.floor(Math.random()*4) + 1));
		}
		
		// add 'official resource' tags to resources
		function addOfficialResourceTags(tableName) {
			var officialResourceCells = tc.jQ(tableName + ' td.official-resource');
			for(var i = 0; i < officialResourceCells.length; i++) {
				var td = officialResourceCells.eq(i)
				var tdPos = td.position();
				var tdWidth = td.outerWidth();

				td.parents('.resources-list').before('<div class="official-resource-tag" style="top:' + tdPos.top + 'px; left:' + tdPos.left + 'px; width:' + (tdWidth - 48) + 'px"><span>Official Resource</span></div>');
				td.css({'padding-top' : '25px'});
			};
		};
		addOfficialResourceTags('table.resources-list');
		
		
	});
</script>
{% endblock page_js %}