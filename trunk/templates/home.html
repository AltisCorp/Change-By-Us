{% extends "./partials/base.html" %}

{% block title %}
Change by Us - Home
{% endblock title %}

{% block continent %}
<div class='continent home'>
	<div class='headlands'>
		<span class="hey"><span>Hey NYC!</span></span>
		<div class='splash-container'>
			<div class='splash-background'></div>
			<div class='splash merlin'>
				<div class="splash-inner first">
					<!-- post your idea step -->
					<div class='top-pane start'>
						
						<div class="console">
							<span class="start console-message"><span></span>How can we make our city a greener, better place to live?</span>
							<span class="more-info after-idea-message" style='display:none;'>Thanks for your idea<br /><span class="sm">We need just a little more information</span></span>
							<span class="thanks after-idea-message" style='display:none;'>Thanks for your idea<br /><span class="sm">Please wait while we process your idea!</span></span>
						</div>
						
						<div class="step-one step-two step">
							<div class="idea-input idea-input-one">
								<div class="primary-action">
									<a class="ca-btn" href="#">
										<span>Post</span>
									</a>
								</div>
								<div class="oops" style="display:none;">
									<span>Oops! Please fill in the fields marked in red.</span>
								</div>
								<div class='idea-input-inner-wrapper'>
									<!--<label>What's your idea?</label>-->
									<textarea class='idea'></textarea>
									<div class="helpers">
										<a href="/about">What is this?</a>
										<a href="#whos-listening">Who's Listening</a>
									</div>
								</div>
							</div>
						
							<div class="info-input" style='display:none;'>
								<div class="west">
									<div>
										<span class="col-head">Your email?</span>
										<input value='{% if d.template_data.user and d.template_data.user.data.email %}{{ d.template_data.user.data.email }}{% endif %}' type='text' name='email' id='email' class='email'/>
										<div class="email-info">
											<p class="email-error">Please enter a valid email address</p>
											<p>We will never send spam or sell your email address.</p>
											<p><em>See our <a href="/tou" class='toc-link'>privacy policy</a> for more details.</em></p>
										</div>
									</div>
								</div>
								<div class="east">
									<span class="col-head">Your idea for...</span>
									<div class="row row-1 clearfix">
										<input type='radio' name='location-check' id='location-city' class='location-city location-group styled'/>
										<label class="location-city-label" for='location-city'>The city</a></label>
									</div>
									<div class="row row-2 clearfix">
										<input type='radio' name='location-check' id='location-hood' class='location-hood location-group styled'/>
										<label class="location-hood-label" for='location-hood'>A neighborhood or borough</a></label>
									</div>
									<div class="row row-3 clearfix">
										<span class="dropdown-indicator"></span>
										<input type='text' name='location-hood-enter' id='location-hood-enter' class='location-hood-enter location-group'/>
										<div class="location-hood-list">
											<ul>
												<li><strong>So</strong>Ho</li>
												<li><strong>So</strong>uth Bronx</li>
											</ul>
										</div>
										<span class="error">Please enter a neighborhood or borough.</span>
									</div>
								</div>
							</div>
						</div><!--end .top-pane.step-two-->
				
						<div class="step idea-processing" style="display:none"></div>
					</div>
					
					<div class="projects-pane">
						<div class="projects-pane-hd">
							<h2><span class="text">Featured Projects</span><a class="ca-btn" href="/search#projects"><span>See all projects</span></a></h2>
						</div>
						<div class="project-cards">
							<div class="membrane">
								
								{% for idea_group in d.template_data.all_ideas.data %}
									<div class ="box area{{ loop.index }} grouping">
										<div class="hd">
											<h3><a href="/project/{{ idea_group.project_id }}">{{ idea_group.title }}</a></h3>
										</div>
										<div class="bd">
											{% for idea in idea_group.ideas %}
												{% if loop.index < 45 %}
													<div class="small-note"><a href='/project/{{ idea_group.project_id }}'><span>{% if idea.f_name %}<cite class="note-meta-hd"><strong>{{ idea.f_name ~ " " ~ idea.l_name }}</strong> says &mdash;</cite>{% endif %}<blockquote><p>{{ idea.text|truncate(180) }}</p></blockquote></span></a></div>
												{% endif %}
											{% endfor %}
										</div>
									</div>
								{% endfor %}
								
							</div>
						</div>
					</div>
				
				</div><!--end .splash-inner-->
				
				<div class="splash-inner">
					<!-- after idea is posted step -->
				
					<div class="top-pane related-processing step-three">
						<div class="console">
							<span class="console-message">
								Turn ideas into solutions.
								Join a project. Or start your own.
							</span>
						</div>
					</div>
				
					<div class="projects-pane step-three found">
						<div class="box related-projects">
							<div class="hd">
								<h2>Related Projects <!-- <em>near</em> <span class="serif"><strong></strong></span> --></h2>
							</div>
							<div class="bd">
								<ul class="projects-list">
								</ul>
								<a href="/search" class="see-more more-projects">See more projects <em>near</em> you &rarr;</a>
							</div>
						</div>
						<div class="box citywide-projects">
							<div class="hd">
								<h2>Citywide Projects</h2>
							</div>
							<div class="bd">
								<ul class="projects-list">
								</ul>
								<a href="/search#projects" class="see-more more-projects">See more citywide projects &rarr;</a>
							</div>
						</div>
						<div class="controls">
							<a href="/search#projects" class="rounded-button">Browse All</a><span>or</span><a href="/create" class="rounded-button">Start Your Own</a>
						</div>
					</div>
				
				
					<div class="projects-pane not-found" style="display:none" >
						<div class="box no-related-projects">
							<div class="hd">
								<h2>No projects found!</h2>
								<p>We didn't find any projects based on your idea or location.  But don't stop there.</p>
							</div>
							<div class="bd">
								<div class="row clearfix">
									<p>Search for projects that interest you:</p>
									<a href="/search#projects" class="rounded-button">Browse All</a>
								</div>
								<div class="row clearfix">
									<p class="center"><em>or</em></p>
								</div>
								<div class="row clearfix">
									<p>Take the lead, and begin a project today.</p>
									<a href="/create" class="rounded-button">Start Your Own</a>
								</div>
							</div>
						</div>
					</div>
				
				
				</div><!--end .splash-inner-->

			</div><!--end .splash-->
			
			<div class="note-card-pane">
				<div class="membrane">
					<div class="note-card-splash">
						{% if d.template_data.all_ideas.data|length > 0 and d.template_data.all_ideas.data[0].ideas[0].f_name %}
							<cite class="note-meta-hd">
								<strong>{{ d.template_data.all_ideas.data[0].ideas[0].f_name ~ " " ~ d.template_data.all_ideas.data[0].ideas[0].l_name }}</strong> said &mdash;
							</cite>
							<blockquote>
								<p>{{ d.template_data.all_ideas.data[0].ideas[0].text|truncate(180) }}</p>
							</blockquote>
						{% endif %}
					</div>
				</div>
				
				<div class="hand">
				</div>
			</div>
				
		</div><!--end .splash-container-->
		
		<div class="social-networking">
			<div class="facebook"><iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.giveaminute.info&amp;layout=standard&amp;show_faces=false&amp;width=600&amp;action=like&amp;font=verdana&amp;colorscheme=light&amp;height=25" scrolling="no" frameborder="0" style="border:none; overflow:hidden; height:25px; width: 600px;" allowTransparency="true"></iframe></div>
		</div>
	</div>

	<div class='midlands clearfix'>
		<div class="west">
			<div>
				<h1><strong>Change by Us</strong> is a place to share ideas, create projects, build teams, and make our city better.</h1>
			</div>
			
			<div class="box whos-listening">
				<div class="hd">
					<a name="whos-listening"></a>
					<h2>Who's listening?</h2>
					<p>A network of leaders from across the city is ready to read ideas, follow projects, and connect online.</p>
				</div>
				<div class="bd">
					<ul>
						<li>
							<img src="/static/images/thumb_mbloomberg.jpg" alt="" width="106" height="80" />
							<p class="name">Michael Bloomberg</p>
							<p class="job">Mayor</p>
						</li>
						<li>
							<img src="/static/images/thumb_sgoldsmith.jpg" alt="" width="106" height="80" />
							<p class="name">Steve Goldsmith</p>
							<p class="job">Deputy Mayor</p>
						</li>
						<li>
							<img src="/static/images/thumb_pshepard.jpg" alt="" width="106" height="80" />
							<p class="name">Peggy Shepard</p>
							<p class="job">West Harlem Environ. Action Coalition</p>
						</li>
						<li class="every-fourth">
							<img src="/static/images/thumb_ryaro.jpg" alt="" width="106" height="80" />
							<p class="name">Robert Yaro</p>
							<p class="job">Regional Plan Assoc.</p>
						</li>
						<li>
							<img src="/static/images/thumb_eyeampierre.jpg" alt="" width="106" height="80" />
							<p class="name">Elizabeth Yeampierre</p>
							<p class="job">Executive Director, UPROSE</p>
						</li>
						<li>
							<img src="/static/images/thumb_akeys.jpg" alt="" width="106" height="80" />
							<p class="name">Alicia Keys</p>
							<p class="job">Musician</p>
						</li>
						<li>
							<img src="/static/images/thumb_agrenier.jpg" alt="" width="106" height="80" />
							<p class="name">Adrian Grenier</p>
							<p class="job">Actor</p>
						</li>
						<li class="every-fourth">
							<img src="/static/images/thumb_dbryne.jpg" alt="" width="106" height="80" />
							<p class="name">David Byrne</p>
							<p class="job">Musician</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="east">
			<div class="box why-use">
				<div class="hd">
					<h2>Why use Change by Us?</h2>
				</div>
				<div class="bd">
					<ol class=" ">
						<li>
							<span class="num"><span>1</span></span>
							<span class="text">Discover resources and friends to help you complete your <a href="/search#projects">community project</a>.</span>
						</li>
						<li>
							<span class="num"><span>2</span></span>
							<span class="text">Connect with leaders from across the city.</span>
						</li>
						<li>
							<span class="num"><span>3</span></span>
							<span class="text">Access a limited number of small grants to get your project off the ground.</span>
						</li>
					</ol>
				</div>
			</div>
			<div class="box whats-happening">
				<div class="hd">
					<h2>What's happening?</h2>
				</div>
				<div class="bd">
					<ul class="news-stack">
						<li>
							<cite class="meta">02.03.2011</cite>
							<h3>New grants program announced!</h3>
							<p>The city is happy to announce a new grant program of up to &#36;4000 for innovative ideas that transform neighborhoods.</p>
						</li>
						<li>
							<cite class="meta">02.20.2011</cite>
							<h3>Change by Us generates new ideas for New York City in 2011</h3>
							<p>The city is happy to announce that it received thousands of ideas this year!</p>
						</li>
					</ul>
				</div>
				<div class="ft">
					<a class="read-more" href="/blog">Read more news &rarr;</a>
				</div>
			</div>
		</div>
	</div>

	<div class='foothills'>

	</div>
	
	<div class='template-content modal-content toc'>
		<h2><strong>Terms and Conditions</strong></h2>
		<div class="scroll-pane">
			{% include 'partials/toc.html' %}
		</div>
		<a class='close' href="#"><span>close</span></a>
	</div>
	
	<li class='template-content project-item'>
		<div class="thumb">
			<img src="http://placehold.it/50x50" alt="" class="proj"/>
			<span class="overlay-tag"></span>
			<span class="member-count">58</span>
		</div>
		<div class="project-info">
			<div class="endorser-thumb clearfix" style='display:none;'>
				<img src="http://placehold.it/30x30" alt="" class="endorser-photo" />
				<span class="overlay-tag"></span>
			</div>
			<span class="link"><a href="/project">Plant a Million Trees</a></span>
			<span class="creator"><em>Created by </em> Terry Richardson<br /><em>from </em> <strong>MillionTreesNYC</strong></span>
			<span class="description">Tired of the empty lot at 161st and Melrose? Let&rsquo;s start a garden...</span>
		</div>
	</li>
	
</div>
{% endblock continent %}

{% block page_js %}
<script>
	app_page.features.push(function(app){
		tc.util.log('Give A Minute: HOME');
		
		tc.jQ('a.toc-link').bind('click',{
			app:app,
			source_element:tc.jQ('.modal-content.toc'),
			init:function(modal,callback){
				if(tc.jQ.isFunction(callback)){
					callback(modal);
				}
			}
		},function(e,d){
			e.preventDefault();
			e.data.app.components.modal.show(e.data);
		});
		
		app.components.merlin = new tc.merlin(app,{
			dom:tc.jQ('.splash.merlin'),
			progress_element:tc.jQ('.merlin-progress'),
			next_button:tc.jQ('.primary-action .ca-btn'),
			error_indicator:tc.jQ('.oops'),
			watch_keypress:true,
			first_step:'start',
			data:{
				text:null,
				email:null,
				location_id:null
			},
			steps:{
				'start':{
					prev_step:null,
					next_step:'idea-details',
					selector:'.step-one',
					inputs:{
						idea:{
							selector:'textarea.idea',
							validators:['min-3','max-200','required'],
							hint:'',
							focus_first:true,
							handlers:{
								focus:function(e){
									e.data.me.options.error_indicator.hide();
								}
							}
						}
					},
					finish:function(merlin,dom){
						merlin.options.data = tc.jQ.extend(merlin.options.data,{
							text:merlin.current_step.inputs.idea.dom.val()
						});
					}
				},
				'idea-details':{
					prev_step:'start',
					next_step:'idea-processing',
					selector:'.step-two',
					inputs:{
						email:{
							selector:'input.email',
							validators:['min-3','max-200','required','email'],
							
							{% if d.template_data.user and d.template_data.user.data.email %}
								hint:false,
							{% else %}
								hint:'Please enter your email address',
							{% endif %}
							
							focus_first:true
						},
						location:{
							selector:'.location-group',
							validators:tc.locationDropdown.validator,
							hint:'Start typing neighborhood or borough...'
						}
					},
					step_data:{},
					transition:function(merlin,dom){
						var elements = {
							pane:merlin.dom.find('.top-pane'),
							idea_input:merlin.dom.find('.idea-input-inner-wrapper'),
							cons:merlin.dom.find('.console'),
							start:merlin.dom.find('.step-one'),
							two:merlin.dom.find('.info-input')
						};
						elements.idea_input.css('height','93.2px').animate({
							width:'0px',
							opacity:0
						},400,'easeOutCubic',function(){
							tc.jQ(this).hide();
							elements.cons.css('width','775px').children('.more-info').show().siblings().hide();
							tc.animate_bg(elements.pane,5,7.5);
							elements.two.css('height','0px').css('opacity',0).show().delay(200).animate({
								opacity:1.0,
								height:'142px'
							},400,'easeOutCubic',function(){
								
							});
						});
						
					},
					init:function(merlin,dom){
						if(!merlin.current_step.step_data.locationDropdown){
							merlin.current_step.step_data.locationDropdown = new tc.locationDropdown({
								radios:dom.find('input[type=radio]'),
								input:dom.find('input.location-hood-enter'),
								list:dom.find('div.location-hood-list'),
								warning:dom.find('span.error'),
								locations:merlin.app.app_page.data.locations
							});
						}
					},
					finish:function(merlin,dom){
						merlin.options.data = tc.jQ.extend(merlin.options.data,{
							email:merlin.current_step.inputs.email.dom.val(),
							location_id:merlin.current_step.step_data.locationDropdown.getLocation()
						});
					}
				},
				'idea-processing':{
					prev_step:'idea-details',
					next_step:'related',
					selector:'.idea-processing',
					transition:function(merlin,dom){},
					init:function(merlin,dom){
						tc.jQ.ajax({
							type:'POST',
							url:'/idea',
							data:merlin.options.data,
							context:merlin,
							dataType:'text',
							success:function(data,ts,xhr){
								if(data == 'False'){
									return false;
								}
								this.options.data.idea_id = data;
								this.dom.siblings('.note-card-pane').find('strong').text('You');
								this.dom.siblings('.note-card-pane').find('blockquote').html('<p>'+merlin.options.data.text+'</p>');
								window.location.hash = 'related-processing';
							}
						});
					}
				},
				'related-processing':{
					prev_step:'idea-details',
					next_step:null,
					//selector:'.related-processing',
					transition:function(merlin,dom){
						merlin.dom.find('.grouping').hide();
						var elements = {
							hey:merlin.dom.parent().siblings('.hey'),
							note:merlin.dom.siblings('.note-card-pane'),
							bkg:merlin.dom.siblings('.splash-background')
						};
						elements.hey.animate({
							top:'-210px'
						},1200,'easeOutCubic');
						elements.bkg.animate({
							marginLeft:'-220px'
						},1400,'easeInOutQuad');
						merlin.dom.animate({
							marginLeft:'-1260px'
						}, 1400,"easeInOutCubic",function(){
							window.location.hash = 'related-processing-2';
						});
						elements.note.css('zIndex',10000).delay(300).animate({
							width:'366px',
							height:'609px'
						},1000,'easeOutCubic');
					}
				},
				'related-processing-2':{
					prev_step:'idea-details',
					next_step:null,
					selector:'.related-processing',
					init:function(merlin,dom){
						tc.jQ.ajax({
							url:'/idea/related',
							data:merlin.options.data,
							context:merlin,
							dataType:'json',
							success:function(data,ts,xhr){
								if(data.citywide.length || data.related.length){
									this.options.steps['related'].step_data = data;
									window.location.hash = 'related';
								} else {
									window.location.hash = 'related-not-found';
								}
							}
						});
					}
				},
				'related':{
					prev_step:'idea-details',
					next_step:null,
					selector:'.step-three',
					init:function(merlin,dom){

						function build_project_items(data, selector) {
							var i, temphtml, box;
							box = dom.find(selector);
							for (i in data) {
								if (i == 2) { break; }
								temphtml = tc.jQ('.template-content.project-item').clone().removeClass('template-content');
								if (data[i].image_id){
									temphtml.find('img').attr('src','/images/'+(data[i].image_id % 10)+'/'+data[i].image_id+'.png');
								}
								temphtml.find('.link a').text(data[i].title)
									.attr('href','/project/'+ data[i].project_id)
									.attr("target", "_blank");
								temphtml.find('.creator').html('<span class="creator"><em>Created by </em> '+ data[i].owner.name +'</span>');
								temphtml.find('.description').text(data[i].description);
								temphtml.find('.member-count').text(data[i].num_members);
								if (data[i].endorsement) {
									temphtml.find('.endorser-thumb').show();
								}
								box.find("ul").append(temphtml);
								box.css("opacity", 0.0).show().animate({
									opacity:1.0
								}, 100, "easeOutCubic");
							}
						}
						
						if(merlin.current_step.step_data){
							if(!merlin.current_step.step_data.related.length && !merlin.current_step.step_data.citywide.length){
								window.location.hash = 'related-not-found';
								return;
							}
							
							if(!merlin.current_step.step_data.related.length){
								dom.find('.related-projects').hide();
								dom.find('.citywide-projects').addClass('single');
							} else {
								build_project_items(merlin.current_step.step_data.related, ".related-projects");
							}
							if(!merlin.current_step.step_data.citywide.length){
								dom.find('.citywide-projects').hide();
								dom.find('.related-projects').addClass('single');
							} else {
								build_project_items(merlin.current_step.step_data.citywide, ".citywide-projects");
							}
							
							if (merlin.current_step.step_data.search_terms.length) {
								dom.find("a.more-projects").attr("href", "/search?terms="+ merlin.current_step.step_data.search_terms +"#projects");
							}
						}
					}
				},
				'related-not-found':{
					prev_step:'idea-details',
					next_step:null,
					selector:'.related-not-found',
					init:function(merlin,dom){
						
					}
				}
			}
		});
		
		var note_source = {{ d.all_ideas }};
		
				
		arrangeNotes("1");
		arrangeNotes("2");
		arrangeNotes("3");
		arrangeNotes("4");
		arrangeNotes("5");
		
		
		// .small-note arrange
		function arrangeNotes(areaNum) {
			//settings
			var gridDistance = 46; // in pixels
			var maxOffset = 14; // in pixels
			
			// selectors
			var areaSelector = ".area"+areaNum;
			var theArea = $(areaSelector);
			var smallNote = $(areaSelector+' .small-note');
			
			// initial values
			var positionX = 0 - gridDistance;
			var positionY = 0;
			var rowCount = 0;
			
			var maxX = theArea.width() - 45;
			var maxY = theArea.height() - theArea.children('.hd').height() - 46;
						
			for(var i = 0; i < smallNote.length; i++) {
				// set initial position according to gridDistance
				positionX = positionX + gridDistance;
				if (positionX > maxX) { 
					if (rowCount%2 == 0) { positionX = gridDistance / 2 } 
					else { positionX = 0 - gridDistance };
					positionY = positionY + (gridDistance / 2);
					rowCount++;
				};
				
				// z-index & new position
				var posOrNegOffset = 1;
				var randomZindex = Math.floor(Math.random()*(100)) + 5;
				var newX = positionX + (Math.floor(Math.random()*maxOffset) * posOrNegOffset);
				var newY = positionY + (Math.floor(Math.random()*maxOffset) * posOrNegOffset);
				
				// randomly place note if it falls out-of-bounds
				if (newX > maxX || newX < 0) { newX = Math.floor(Math.random()*(maxX + 1)); }
				if (newY > maxY || newY < 0) { newY = Math.floor(Math.random()*(maxY + 1)); }
			
				// background image
				var bgImgClass;
				var bgImgCounter = i%3 + 1;
				
				if (bgImgCounter == 1 && i%2 == 0) { bgImgCounter++ }; // makes style 1 of the small notes less common
				
				if      (areaNum == 1) { bgImgClass = "a" + bgImgCounter }
				else if (areaNum == 2) { bgImgClass = "b" + bgImgCounter }
				else if (areaNum == 3) { bgImgClass = "c" + bgImgCounter }
				else if (areaNum == 4) { bgImgClass = "d" + bgImgCounter }
				else                   { bgImgClass = "e" + bgImgCounter };
				
				// set style
				smallNote.eq(i).addClass(bgImgClass).css({'display' : 'block', 'top' : newY, 'left' : newX, 'zIndex' : randomZindex});
			};
		};
		
		// show .hand
		tc.jQ('.hand').addClass('hand' + (Math.floor(Math.random()*3) + 1)).show();


		// .small-note hover
		smallNoteHover("1");
		smallNoteHover("2");
		smallNoteHover("3");
		smallNoteHover("4");
		smallNoteHover("5");
				
		
		function smallNoteHover(areaNum) {
			var hoverZindexCounter = 106;
			var areaSelector = ".area" + areaNum;
			var bigNoteCardSelector = tc.jQ(".note-card-splash");
			var noteCardPane = tc.jQ(".note-card-pane");
			
			var theHandClass = "hand" + ((areaNum % 3) + 1);

			$(areaSelector + " .small-note").hover(
				function () {
					tc.jQ(this).css({'zIndex' : hoverZindexCounter});
					var theContents = $(this).find('span').html();
					
					bigNoteCardSelector.stop(true, true).fadeOut(50);
					bigNoteCardSelector.html( theContents ).fadeIn(150);
					
					tc.jQ('.hand').removeClass('hand1 hand2 hand3 hand4').addClass(theHandClass);
					if (noteCardPane.hasClass('color' + areaNum)) {
						// do nothing
					} else {
						noteCardPane.removeClass('color1 color2 color3 color4 color5').addClass('color' + areaNum);
					};
				},
				function () {
					hoverZindexCounter++;
				}
			); 
		};
		
		
		
		
		// turn location field autocomplete off
		tc.jQ('#location-hood-enter').attr('autocomplete', 'off');

	});
</script>
<script src="/static/js/libs/prettyCheckboxes.js" type="text/javascript"></script>
<script type="text/javascript">
	tc.jQ(document).ready(function(){
		tc.jQ('input[type=checkbox],input[type=radio]').prettyCheckboxes();
	});
</script>
{% endblock page_js %}