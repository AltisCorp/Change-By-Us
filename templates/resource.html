{% extends "./partials/base.html" %}

{% block title %}
Change by Us - Add Resource
{% endblock title %}

{% block continent %}

<div class='continent add-resource'>
	<div class='headlands'>

	</div>

	<div class='midlands merlin resource-addition clearfix'>
		
		<div class='step resource-form'>
		
			<div class="west">
				<div class="box">
					<div class="hd">
						<h1><strong>Add</strong> your resource</h1>
					</div>
					<div class="bd">
						<p>Welcome! We're always looking to list more valuable organizations, services, and programs on Change By Us – to give users a variety of resources to add to their projects.</p>
						<p>To be considered, just fill out this form.<span class="smaller">*</span> We'll notify you by email when you have been approved as a resource to be listed on Change By Us.<span class="smaller">**</span> </p>
						<p>When you have been approved, users will be able to find your resource on the site and add it to their project pages. When they do, you’ll get an email inviting you to visit their page to see if you can help.</p>
						<span class="smaller">
							<p>*Please use this form only if you are an employee or direct affiliate of the organization, service, or program.</p>
							<p>**We’ll post only resources relevant to the questions being asked on the site.</p>
						</span>
					</div>
				</div>
			</div>
			
			<div class="east">
				<form>
					<div class="upload-image clearfix">
						<div class="thumb">
							<img class='proj' src="/static/images/thumb_genAvatar100.png" alt="" />
						</div>
						<div class="upload-image-controls">
							<a href="#" class='upload-link'>Upload</a> an image (100px by 100px)
						</div>
					</div>
					<div class="fields">
						<div class="row">
							<label>Resource Name</label>
							<input type="text" class='name'/>
						</div>
						<div class="row">
							<label>Description</label>
							<textarea class='description'></textarea>
						</div>
						<div class="row">
							<label>Address</label>
							<input type="text" class='address'/>
						</div>
						<div class="row">
							<label>Web Address</label>
							<input type="text" class='web'/>
						</div>
						<div class="row">
							<label>Other links (if applicable) Facebook, Twitter, Blog, etc</label>
							<input type="text" class='links'/>
							<div class="control add-another">
								<a href="#">&#43; Another Link</a>
							</div>
						</div>
						<div class="row">
							<label>Keywords (separate by commas)</label>
							<input type="text" class='keywords'/>
						</div>
						<div class="row">
							<label>Contact email<span class="note"><strong>Important</strong> This email is for Change by Us to get in touch with you whenever a project adds your organization as a resource.</span></label>
							<input type="text" class='contact'/>
						</div>
						<div class="row">
							<input type="checkbox" id="agree-tos" class='contact' />
							<label for="agree-tos">I have read and accept the <a href="/tou"><strong>Terms &amp; Conditions</strong></a></label>
						</div>
					</div>
					<div>
						<input type='submit' name='add-org' id="add-org" class="rounded-button" value='Add My Resource' />
					</div>
				</form>
				
				<div class="thanks">
					<p><strong>Thanks for submitting a resource! </strong><br />We will contact you when your resource has been approved.</p>
					<a href="/resource">Add another resource</a>
					<a class="prev" href="/"><span class="sm-arrow-back light"></span><span>Go back home</span></a>
				</div>
			</div>
		</div><!--end step-->
		
		<div class='step finish clearfix spinner-message' style='display:none;'>
			<p>Please hold while we process your request...</p>
			<p><img src='/static/images/loader32x32.gif' /></p>
		</div>
		
		<div class='step thank-you' style='display:none;'>
			<p>Thank you for adding your organization. You will receive an email confirming its addition.</p>
		</div>
	</div>

	<div class='foothills'>

	</div>
	
	<div class='template-content modal-content upload-image'>
		<div class='step add-link-step'>
			<h2><strong>Upload</strong> a photo for your project.</h2>
			<p>Photos should be <strong>under 1MB</strong> please. (We also crop photos to <strong>90px by 90px</strong>)</p>
			<div class="file-uploader"></div>
		</div>
		<a class='close' href="#"><span>close</span></a>
	</div>
</div>
{% endblock continent %}

{% block page_js %}
<script>
	app_page.features.push(function(app){
		tc.util.log('Give A Minute: Resource Addition');
		
		tc.jQ('a.upload-link').bind('click',{
			app:app,
			source_element:tc.jQ('.modal-content.upload-image'),
			init:function(modal,callback){
				var uploader = new qq.FileUploader({
					element: modal.options.element.find('.file-uploader').get(0),
					action: '/create/photo',
					onComplete: function(id, fileName, responseJSON){
						
						tc.jQ(document).trigger('create-image-uploaded',{
							id:id,
							fileName:fileName,
							responseJSON:responseJSON
						});
						
						return true;
						
					}
				});
				if(tc.jQ.isFunction(callback)){
					callback(modal);
				}
			}
		},function(e,d){
			e.preventDefault();
			e.data.app.components.modal.show(e.data);
		});
		
		app.components.merlin = new tc.merlin(app,{
			dom:tc.jQ('.merlin.resource-addition'),
			next_button:tc.jQ('#add-org'),
			first_step:'resource-form',
			data:{
				title:null,
				description:null,
				physical_address:null,
				location_id: null,
				url: null,
				keywords: null,
				contact_name: null,
				contact_email: null,
				other_urls: null,
				image: null
			},
			steps:{
				'resource-form':{
					selector:'.resource-form',
					next_step:'finish',
					inputs:{
						name:{
							selector:'input.name',
							validators:['min-3','max-32','required'],
							hint:''
						},
						description:{
							selector:'textarea.description',
							validators:['min-3','max-200','required'],
							hint:''
						},
						address:{
							selector:'input.address',
							validators:['min-3','max-32','required'],
							hint:''
						},
						web:{
							selector:'input.web',
							validators:['min-3','max-32','url'],
							hint:''
						},
						links:{
							selector:'input.links',
							validators:['min-3','max-32','csv-url'],
							hint:''
						},
						keywords:{
							selector:'input.keywords',
							validators:['min-3','max-200','required'],
							hint:''
						},
						contact:{
							selector:'input.contact',
							validators:['min-3','max-32','required','email'],
							hint:''
						}
					},
					init:function(merlin,dom){
						tc.jQ(document).unbind('create-image-uploaded').bind('create-image-uploaded',{merlin:merlin}, function(e, d){
							e.data.merlin.app.components.modal.hide();
							if(d.responseJSON.thumbnail_id){
								merlin.dom.find('img.proj').attr('src','/images/'+(d.responseJSON.thumbnail_id % 10)+'/'+d.responseJSON.thumbnail_id+'.png');
								merlin.options.data.image = d.responseJSON.thumbnail_id;
							}
						});
					},
					finish:function(merlin,dom){
						merlin.options.data = tc.jQ.extend(merlin.options.data,{
							title:merlin.current_step.inputs.name.dom.val(),
							description:merlin.current_step.inputs.description.dom.val(),
							physical_address:merlin.current_step.inputs.address.dom.val(),
							url:merlin.current_step.inputs.web.dom.val(),
							other_urls:merlin.current_step.inputs.links.dom.val(),
							keywords:merlin.current_step.inputs.keywords.dom.val(),
							contact_email:merlin.current_step.inputs.contact.dom.val()
						});
					}
				},
				'finish':{
					selector:'.finish',
					init:function(merlin,dom){
						tc.jQ.ajax({
							type:'POST',
							url:'/resource',
							data:merlin.options.data,
							context:merlin,
							dataType:'text',
							success:function(data,ts,xhr){
								if(data == 'False'){
									return false;
								}
								window.location.hash = 'thank-you';
							}
						});
					},
					'thank-you':{
						selector:'.thank-you'
					}
				}
			}
		});
		
	});
</script>
{% endblock page_js %}