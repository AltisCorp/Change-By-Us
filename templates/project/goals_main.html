<!-- begin goals-main -->	
<div class="box goals-main">
	<div class="hd clearfix">
		<h2>
			<span>
				Goals 
				<span class="counter">{{ d.template_data.project.data.info.goals['items']|length }}</span>
				{% if d.template_data.project_user.data.is_project_admin %}
					<span class="control"><a href="#show,goals_stack" class="manage">Manage</a></span>
				{% endif %}
			</span>
		</h2>
		<div class="actions">
			{% if d.template_data.project_user.data.is_member %}
				<a href="#show,goals_add" class='add'>Propose Your Own</a>
			{% endif %}
		</div>
	</div>
	
	<div class="goals-display" style="{% if not d.template_data.project.data.info.goals['items']|length > 0 %}display:none;{% endif %}">
		<h3 class="fancy-caps active-goal-indicator" style="filter:alpha(opacity=0); -moz-opacity:0; -khtml-opacity: 0; opacity: 0;"><span>The</span> Active Goal <span>for this</span> Project</h3>
		<div class="carousel">
			<div class="scrollable">
				<ul class="items">
					
					{% macro generate_goal(goal) -%}
						<li rel='{{ goal.goal_id }},{{ goal.active }}'>
							<div class="goal-card">
								{% if d.template_data.project_user.data.is_project_admin or d.template_data and d.template_data.user and d.template_data.user.is_admin %}
									<a class="close" href="#close,{{ goal.goal_id }}"><span>Close</span></a>
								{% endif %}
								
								{% if d.template_data.project_user.data.is_project_admin %}
									{% if not goal.active %}
										<div class="make-this-active">
											<a href="#makeActive,{{ goal.goal_id }}" class="fancy-caps">Make <span>this the</span> Active Goal</a>
										</div>
									{% endif %}
								{% endif %}
								
								{% if goal.accomplished %}
									<div class="label-accomplished">
										Accomplished!
									</div>
								{% elif d.template_data.project_user.data.is_project_admin %}
									<div class="control-accomplished">
										<a class="fancy-caps" href="#markAccomplished,{{ goal.goal_id }}">
											Mark <span>as</span> Accomplished
										</a>
									</div>
								{% endif %}
								
								<p>{{ goal.text }}</p>
								<div class="meta">
									<dl>
										<dt>Timeframe</dt>
										<dd>{{ goal.timeframe }}</dd>
										
										<dt>Point Person</dt>
										<dd><a href='/useraccount/{{ goal.owner.u_id }}'>{{ goal.owner.name|truncate(15) }}</a></dd>
									</dl>
									
									<div class="timestamp">
										<strong>Added:</strong>
										<span class="datetime">{{ goal.created_datetime }}</span>
									</div>
								</div>
							</div>
						</li>
					{%- endmacro %}
					
					{% for goal in d.template_data.project.data.info.goals['items'] %}
						{% if goal.active %}
							{{ generate_goal(goal) }}
						{% endif %}
					{% endfor %}
					
					{% for goal in d.template_data.project.data.info.goals['items'] %}
						{% if not goal.active %}
							{{ generate_goal(goal) }}
						{% endif %}
					{% endfor %}
					
				</ul>
			</div>
			<div class="carousel-controls">
				<a class="next" href="#">
					<span>Next</span>
				</a>
			</div>
		</div>
	</div>
	
	{% if d.template_data.project_user.data.is_member %}
		<div class="goals-empty" style="{% if d.template_data.project.data.info.goals['items']|length > 0 %}display:none;{% endif %}">
			<h3 class="fancy-caps active-goal-indicator">Make <span>an</span> Active Goal <span>for this</span> Project</h3>
			<div class="empty-state-box big">
				<!--<a class="close" href="#"><span>Close</span></a>-->
				<p>Goals help define what you want to do and help you get it done. Why not <a href="#show,goals_add">add a goal now?</a></p>
			</div>
		</div>
	{% else %}
		<div class="goals-empty" style="{% if d.template_data.project.data.info.goals['items']|length > 0 %}display:none;{% endif %}">
			
			<h3 class="fancy-caps"></h3>
			<div class="empty-state-box big">
				<p>Goals help you define what you want to do and get your project done more efficiently. No goals have been added to this project yet.</p>
			</div>
		</div>
	{% endif %}
	
</div>

<div class='template-content goal'>
	<div class="goal-card">
		{% if d.template_data.project_user.data.is_project_admin or d.template_data and d.template_data.user and d.template_data.user.is_admin %}
			<a class="close" href="#close,"><span>Close</span></a>
		{% endif %}
		
		{% if d.template_data.project_user.data.is_project_admin %}
			<div class="make-this-active">
				<a href="#makeActive," class="fancy-caps">Make <span>this the</span> Active Goal</a>
			</div>
			<div class="control-accomplished">
				<a class="fancy-caps" href="#markAccomplished,">
					Mark <span>as</span> Accomplished
				</a>
			</div>
		{% endif %}
		
		
		<div class="label-accomplished">
			Accomplished!
		</div>
		
		<p class='goal-title'></p>
		<div class="meta">
			<dl>
				<dt>Timeframe</dt>
				<dd class='timeframe'></dd>
				<dt>Point Person</dt>
				<dd class='owner-name'></dd>
			</dl>
			
			<div class="timestamp">
				<strong>Added:</strong>
				<span class="datetime"></span>
			</div>
		</div>
	</div>
</div>

<script type='text/javascript' src="/static/js/pages/project.goal_main.js"></script>
<!-- end .goals-main -->